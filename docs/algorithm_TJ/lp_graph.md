# 关联矩阵（Incidence Matrix）

图的关联矩阵是一个`|E|*|V|`的矩阵（记作`B`），`b[i][j]` =
- -1, if edge i leaves vertex j
- 1, if edge i enters vertex j
- 0, otherwise

```python
>>> import numpy as np
>>> A = np.array([[-1,1,0,0],[-1,0,1,0],[0,-1,1,0],[-1,0,0,1],[0,-1,0,1],[0,0,-1,1]])
>>> A
array([[-1,  1,  0,  0],
       [-1,  0,  1,  0],
       [ 0, -1,  1,  0],
       [-1,  0,  0,  1],
       [ 0, -1,  0,  1],
       [ 0,  0, -1,  1]])
```

上面的`A`关联矩阵表示的图用邻接链表表示便是：

```
(1): (2), (3), (4)
(2): (3), (4)
(3): (4)
(4): NIL
```

图中的环（loop）是例如这样的一组边：

```
(1) -> (2), (2) -> (3);
(1) -> (3);
```

如果图中有环的话，它的关联矩阵的行与行之间便是不独立的。通过消去（elimination）便可以得到一棵没有环的树。

```python
>>> from scipy.linalg import lu
>>> L,U = lu(A, permute_l=True)
>>> U
array([[-1.,  1.,  0.,  0.],
       [ 0., -1.,  1.,  0.],
       [ 0.,  0., -1.,  1.],
       [ 0.,  0.,  0.,  0.]])
```

结果`U`用邻接链表表示便是：

```
(1): (2)
(2): (3)
(3): (4)
(4): NIL
```

下面分析该矩阵：

### `N(A)`

我们考察`Ax = 0`，不难发现要满足该方程，便要各`x`之间的差为0。因此`x = c*ones(1*|V|)`，`r(N(A)) = 1`。

### `C(A')`

我们知道，`r(N(A)) + r(C(A')) = |V|`，因此`r(C(A')) = |V| - 1`。从上面例子的结果来看，`U`的秩是4 - 1 = 3。判断一个向量是否在`C(A')`中的方法是：看向量所有元素之和是否为0，即`Ax = 0`，其中`x = c*ones(1*|V|)`。

### `C(A)`

`r(C(A)) = r(C(A')) = |V| - 1`。

判断向量`b`是否在`C(A)`中的一个方法是解`Ax = b`方程。另一种方法是：我们知道，对于环，例如：
```
(1) -> (2), (2) -> (3);
(1) -> (3);
```

`Ax`中这三条边对应的量分别是：`x[2]-x[1], x[3]-x[2], x[3]-x[1]`。我们注意到，这三个量之和应是0。同样，我们可以对图中每一个环来检验向量`b`的各分量。

### `N(A')`

`r(N(A')) = |E| - r(C(A)) = |E| - |V| + 1`。这里，我们考察的是方程`A'y = 0`。这个方程的意义是：对于每一个节点，流入和流出的量是平衡的；而流量就是方程的解`y`。而如果每个“小”环上的流量是平衡的，那对于每个节点的流量也是平衡的，“大”环的流量也是平衡的（“大”环的平衡流量可以用所有小环的平衡流量线性表示）。

一方面，这是基尔霍夫定律之一。另一方面，也可得到欧拉公式：

(number of nodes) - (number of edges) + (number of small loops) = 1

也就是`N(A')`的秩是和所有小环的数量相等的。

## 拉普拉斯矩阵（Laplacian Matrix）

在物理中，记`x`是电路中各点的电压，则`Ax`是各条边上的电压差；记`C=1/R`为电导率，则`CAx`是各条边上的电流，要平衡则是求`A'CAx = 0`。但若电路中有例如电池这样的电源，则为`A'CAx = f`。如果`C = I`，则为`A'Ax = 0`。其中`A'A`便是拉普拉斯矩阵。

《算法导论》上要求考察有向图的拉普拉斯矩阵中各元素的含义，它的含义如下：对于其中的元素`l[i][j]`，如果`i=j`，则`l[i][j]`为`i`节点的出度与入度之和；如果`i≠j`，则`l[i][j]`为`i`节点与`j`节点之间边的数量的相反数（正因为如此，它是对称的）。

## 参考资料

[1] Gilbert Strang. Introduction to Linear Algebra

[2] CLRS. Introduction to Algorithms

